---
name: dev-impl-test
description: L2编码+测试技能。合并编码实现与单元测试，边实现边测试。适用于中等复杂度任务。
---

# 编码+测试 (Implementation with Test)

> L2中等流程第4阶段：按计划编码 → 同步编写测试 → AI审查 → 质量门禁 → 确认

---

## 适用场景

- 新增表单字段类型
- 新增业务组件
- 常规功能开发
- 模块内扩展

---

## 执行流程

```
┌─────────────────────────────────────┐
│ 0. 加载上下文 (自动)                 │
│    - dev-context-loader             │
│    - 读取需求分析、技术方案          │
│    - 读取编码计划                    │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 1. 按任务编码                        │
│    - 遵循编码计划顺序                │
│    - 每完成一个任务同步写测试        │
│    - 保持代码规范                    │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 2. 同步测试                          │
│    - 核心逻辑必须有测试              │
│    - 覆盖正常和异常场景              │
│    - 目标覆盖率 ≥70%                 │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 3. 验证与自检                        │
│    - 编译检查                        │
│    - 运行所有测试                    │
│    - 代码规范检查                    │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 4. AI代码审查 (自动)                 │
│    - dev-ai-review                  │
│    - 5维度审查                       │
│    - ❌有红色项 → 修复后继续         │
│    - ⚠️警告 → 建议修复               │
│    - ✅通过 → 继续门禁               │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 5. 质量门禁 (自动)                   │
│    - dev-quality-gate               │
│    - 综合5项指标评分                 │
│    - <60分 → 阻断，必须修复          │
│    - 60-79分 → 警告，建议修复        │
│    - ≥80分 → 通过                   │
└─────────────────────────────────────┘
     ↓
✓ 确认点 → 进入对齐+文档阶段
```

---

## 步骤0: 上下文加载

在开始编码前，自动执行上下文加载：

```
调用 dev-context-loader
     ↓
读取并显示:
├── 需求分析要点
│   ├── 核心需求
│   ├── 涉及模块
│   └── 业务规则
├── 技术方案要点
│   ├── 核心思路
│   ├── 扩展点
│   └── 数据模型
├── 编码计划
│   ├── 任务列表
│   └── 实现顺序
└── 关键决策
    └── 技术选型
```

---

## 编码+测试模式

采用"实现-测试"交替模式：

```
任务1: 创建字段类
  ├── 实现: AIButtonField.java
  └── 测试: AIButtonFieldTest.java
      ↓
任务2: 创建处理器
  ├── 实现: AIButtonHandler.java
  └── 测试: AIButtonHandlerTest.java
      ↓
任务3: 集成配置
  ├── 实现: 配置文件
  └── 测试: 集成测试
```

---

## 输出模板

```markdown
## 编码+测试完成

### 实现清单
| 任务 | 文件 | 状态 | 测试 |
|------|------|------|------|
| 1.1 创建字段类 | AIButtonField.java | ✅ | ✅ |
| 1.2 创建处理器 | AIButtonHandler.java | ✅ | ✅ |
| 1.3 添加配置 | widget-config.json | ✅ | - |

### 测试报告
- 测试类数: 3
- 测试用例数: 12
- 通过率: 100%
- 覆盖率: 75%

### 代码统计
- 新增文件: 5
- 修改文件: 2
- 代码行数: +320 / -15

### 验证状态
- [x] 编译通过
- [x] 单元测试全部通过
- [x] 代码规范检查通过

---

下一步: 进入对齐+文档阶段
```

---

## 步骤4: AI代码审查

编码完成后，自动触发 AI 代码专项审查：

```
调用 dev-ai-review
     ↓
┌─────────────────────────────────────────────────────────────┐
│  🔍 AI代码专项审查                                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  维度1: 业务逻辑      ✅ 符合需求分析中的业务规则             │
│  维度2: 架构一致性    ✅ 与技术方案一致                       │
│  维度3: 代码规范      ⚠️ 2个警告                             │
│  维度4: 安全检查      ✅ 无风险                               │
│  维度5: 测试充分性    ⚠️ 覆盖率 68%                          │
│                                                              │
│  结论: ⚠️ 建议修复 (无阻断项，可继续)                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 审查结果处理

| 结果 | 说明 | 操作 |
|------|------|------|
| ❌ 阻断 | 有红色项 (业务逻辑错误/安全漏洞) | 必须修复后重新审查 |
| ⚠️ 警告 | 有黄色项 (规范/覆盖率) | 建议修复，可继续 |
| ✅ 通过 | 全部绿色 | 直接进入质量门禁 |

---

## 步骤5: 质量门禁

AI 审查通过后，自动执行质量门禁检查：

```
调用 dev-quality-gate
     ↓
┌─────────────────────────────────────────────────────────────┐
│  🚦 质量门禁检查                                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  测试覆盖率    78%   ✅ (≥70%)              [25分/30分]      │
│  AI审查        通过  ✅ (无红色)             [25分/25分]      │
│  编译状态      成功  ✅                      [20分/20分]      │
│  代码规范      3警告 ✅ (≤5)                [12分/15分]      │
│  方案对齐      85%   ✅ (≥80%)              [ 8分/10分]      │
│                                                              │
│  综合评分: 90/100                                            │
│  结果: ✅ 通过                                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 门禁结果处理

| 总分 | 结果 | 操作 |
|------|------|------|
| <60分 | ❌ 阻断 | 必须修复，无法继续 |
| 60-79分 | ⚠️ 警告 | 建议修复后继续 |
| ≥80分 | ✅ 通过 | 等待用户确认，进入下一阶段 |

---

## 与完整流程对比

| 项目 | 完整流程 (阶段5+6) | L2合并 |
|------|-------------------|--------|
| 时间 | 2-4小时 | 1.5-2.5小时 |
| 产物 | 代码 + 测试 + 覆盖率报告 | 代码 + 测试 |
| 确认 | 2次 | 1次 |
| 覆盖率 | ≥80% | ≥70% |

---

## 编码规范

### 代码结构
```java
/**
 * [类说明]
 */
public class XXX {
    // 字段
    private String field;

    // 构造器
    public XXX() {}

    // 公共方法
    public void method() {}

    // 私有方法
    private void helper() {}
}
```

### 测试命名
```java
@Test
void should[预期行为]_when[条件]() {
    // Arrange
    // Act
    // Assert
}
```

---

## 使用示例

```
编码计划:
- 任务1: 创建AIButtonField字段类
- 任务2: 创建AIButtonHandler处理器
- 任务3: 添加Widget配置

AI 执行编码+测试:
1. 任务1:
   - 实现: AIButtonField.java (+80行)
   - 测试: AIButtonFieldTest.java (4个用例)

2. 任务2:
   - 实现: AIButtonHandler.java (+120行)
   - 测试: AIButtonHandlerTest.java (6个用例)

3. 任务3:
   - 实现: widget-config.json (+15行)

4. 验证:
   - 编译: ✅
   - 测试: 10/10 通过
   - 覆盖率: 78%

等待用户确认...
```

---

## 与其他skill的协作

| Skill | 协作方式 |
|-------|----------|
| dev-context-loader | 步骤0自动调用，加载上下文 |
| dev-coding-plan | 读取编码计划作为实现依据 |
| dev-ai-review | 步骤4自动调用，5维度代码审查 |
| dev-quality-gate | 步骤5自动调用，多指标门禁检查 |
| dev-finish | 门禁通过后进入对齐+文档阶段 |
