---
name: dev-next
description: 快捷命令：继续下一阶段。根据任务级别(L1/L2/L3)动态路由到对应的下一阶段。
---

# 继续下一阶段 (/dev-next)

> 快捷命令，根据任务级别动态路由到下一个开发阶段

---

## 使用方式

```
/dev-next
```

---

## 执行流程

```
用户执行 /dev-next
     ↓
┌─────────────────────────────────────┐
│ 1. 读取进度文件                      │
│    - 加载 .progress.json             │
│    - 获取 flowTemplate.type          │
│    - 获取 currentStage               │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 2. 确认当前阶段已完成                │
│    - 检查 status = completed         │
│    - 验证产物是否生成                │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 3. 查找下一阶段                      │
│    - 根据级别查路由表                │
│    - 确定下一阶段Skill               │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 4. 更新进度并调用                    │
│    - currentStage++                  │
│    - 调用下一阶段Skill               │
└─────────────────────────────────────┘
```

---

## 阶段路由表

### L1 简单流程 (3阶段)

| 当前阶段 | 下一阶段 | 调用的Skill |
|----------|----------|-------------|
| 快速分析 | 快速实现 | `/dev-quick-impl` |
| 快速实现 | 快速收尾 | `/dev-quick-finish` |
| 快速收尾 | 需求完成 | - |

### L2 中等流程 (5阶段)

| 当前阶段 | 下一阶段 | 调用的Skill | 确认点 |
|----------|----------|-------------|--------|
| 需求分析 | 技术分析+方案 | `/dev-tech-combined` | - |
| 技术分析+方案 | 编码计划 | `/dev-coding-plan` | ✓ |
| 编码计划 | 编码+测试 | `/dev-impl-test` | - |
| 编码+测试 | 对齐+文档 | `/dev-finish` | ✓ |
| 对齐+文档 | 需求完成 | - | - |

### L3 复杂流程 (8阶段)

| 当前阶段 | 下一阶段 | 调用的Skill |
|----------|----------|-------------|
| 需求分析 | 技术分析 | `/dev-tech-analysis` |
| 技术分析 | 技术方案 | `/dev-tech-spec` |
| 技术方案 | 编码计划 | `/dev-coding-plan` |
| 编码计划 | 编码实现 | `/dev-coding` |
| 编码实现 | 单元测试 | `/dev-unit-test` |
| 单元测试 | 方案对齐 | `/dev-alignment` |
| 方案对齐 | 文档生成 | `/dev-documentation` |
| 文档生成 | 需求完成 | - |

---

## 动态路由逻辑

```
读取 .progress.json
     ↓
flowTemplate.type = ?
     ├── L1_SIMPLE  → 使用L1路由表
     ├── L2_MEDIUM  → 使用L2路由表
     └── L3_COMPLEX → 使用L3路由表
     ↓
查找 stageTransitions[currentStage.id]
     ↓
返回下一阶段Skill
```

---

## 进度更新

执行 `/dev-next` 时更新 `.progress.json`:

```json
{
  "currentStage": 2,
  "stages": [
    {
      "stage": 1,
      "status": "completed",
      "endTime": "2026-02-09T10:15:00"
    },
    {
      "stage": 2,
      "status": "in_progress",
      "startTime": "2026-02-09T10:16:00"
    }
  ]
}
```

---

## 需求完成处理

当到达最后一个阶段并完成时：

```
┌─────────────────────────────────────────────────────────────┐
│  🎉 需求完成                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  需求: [需求名称]                                            │
│  级别: L1 (简单任务)                                        │
│  流程: 3阶段 / 1确认                                        │
│                                                              │
│  耗时: 25分钟                                               │
│  改动: 2个文件 / +11行                                      │
│                                                              │
│  产物:                                                       │
│  - 需求总结.md                                              │
│  - 代码提交: abc1234                                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 确认点处理

在确认点阶段，`/dev-next` 需要用户明确确认：

```
L2流程确认点:
- 阶段2 (技术分析+方案) 完成后
- 阶段4 (编码+测试) 完成后

确认流程:
     ↓
┌─────────────────────────────────────┐
│ 1. 触发质量门禁 (自动)               │
│    - 调用 dev-quality-gate          │
│    - 综合评分                        │
│    - 决定是否可以继续                │
└─────────────────────────────────────┘
     ↓
┌─────────────────────────────────────┐
│ 2. 显示确认提示                      │
│    - 门禁结果                        │
│    - 产物预览                        │
│    - 等待用户确认                    │
└─────────────────────────────────────┘
```

### 门禁检查示例

```
┌─────────────────────────────────────────────────────────────┐
│  ⏸ 确认点 (阶段4: 编码+测试)                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  🚦 质量门禁: 90/100 ✅ 通过                                │
│                                                              │
│  ├── 测试覆盖率:    78%   ✅                                │
│  ├── AI审查:        通过  ✅                                │
│  ├── 编译状态:      成功  ✅                                │
│  ├── 代码规范:      3警告 ✅                                │
│  └── 方案对齐:      85%   ✅                                │
│                                                              │
│  产物预览:                                                   │
│  - 代码文件: 5个                                            │
│  - 测试文件: 3个                                            │
│                                                              │
│  请确认是否继续下一阶段？                                   │
│                                                              │
│  [确认继续] [查看门禁详情] [修改]                           │
└─────────────────────────────────────────────────────────────┘
```

### 门禁阻断示例

```
┌─────────────────────────────────────────────────────────────┐
│  ⏸ 确认点 (阶段4: 编码+测试)                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  🚦 质量门禁: 55/100 ❌ 阻断                                │
│                                                              │
│  ├── 测试覆盖率:    45%   ❌ (需要≥70%)                     │
│  ├── AI审查:        阻断  ❌ (有安全问题)                   │
│  ├── 编译状态:      成功  ✅                                │
│  ├── 代码规范:      -     ⏸                                │
│  └── 方案对齐:      -     ⏸                                │
│                                                              │
│  必须修复以下问题:                                          │
│  1. 增加测试用例，覆盖率需≥70%                             │
│  2. 修复 TaskDispatcher.java:78 SQL注入风险                │
│                                                              │
│  ⚠️ 无法继续，请修复后重新执行 /dev-next                   │
│                                                              │
│  [查看门禁详情] [强制跳过 --force]                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 等同于

```
/dev-orchestrator 继续
```

---

## L3-AUTO 自动流转

当流程模板为 `L3_AUTO` 时，`/dev-next` 支持自动流转：

```
L3-AUTO模式:
     ↓
┌─────────────────────────────────────┐
│ 检查 flowTemplate.autoFlow          │
│    - true → 自动执行下一阶段         │
│    - false → 等待用户调用            │
└─────────────────────────────────────┘
     ↓ (autoFlow = true)
┌─────────────────────────────────────┐
│ 执行质量门禁                         │
│    - 通过 → 自动进入下一阶段         │
│    - 失败 → 暂停并通知用户           │
└─────────────────────────────────────┘
```

### 自动流转与手动流转对比

| 模式 | 确认点 | 门禁失败 | 恢复方式 |
|------|--------|----------|----------|
| L3 手动 | 每阶段等待确认 | 阻断，等待修复 | 修复后 `/dev-next` |
| L3-AUTO | 无需确认 | 暂停并通知 | 修复后 `/dev-resume` |

---

## 与其他skill的协作

| Skill | 协作方式 |
|-------|----------|
| dev-quality-gate | 确认点前自动执行门禁 |
| dev-auto-flow | L3-AUTO模式的流转控制 |
| dev-orchestrator | 提供 `/dev-next` 别名 |
